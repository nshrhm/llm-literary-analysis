# 機能ガイド

## コア機能

### 文学解析
- LLMによる文学作品の理解度評価
- 感情分析（面白さ、驚き、悲しみ、怒り）
- 定量的スコアリング（0-100）
- 理由付けの自動生成

### マルチモデル対応
- 複数のLLMプロバイダーのサポート
- モデル固有の最適化
- 統一されたインターフェース
- 結果の標準化と比較

## 統一プロンプト管理

### 基本設計
- 一元化されたプロンプト定義
- モデル固有のフォーマット適応
- システムメッセージとユーザーメッセージの分離
- 再利用可能なテンプレート

### モデル別の対応
1. 標準メッセージフォーマット
   - OpenAI
   - Gemini
   - Grok

2. 特殊フォーマット
   - Claude：コンテンツフォーマット
   - o1-mini：システムロール制限
   - o3-mini：温度パラメータ制限

### プロンプト検証
- 形式の自動チェック
- 必須要素の確認
- エラー検出と報告
- 自動修正の提案

## 温度制御システム

### ペルソナベース制御
各ペルソナの特性に基づく基本温度設定：
- 大学1年生（0.7）：柔軟な発想を促進
- 文学研究者（0.4）：論理的分析を重視
- 感情豊かな詩人（0.9）：創造性を最大化
- 無感情なロボット（0.1）：決定論的な応答

### テキスト特性による調整
テキストの性質に応じた温度修正：
- 寓話的テキスト：±0.1
- 物語的テキスト：±0.2
- 詩的テキスト：±0.3

### 計算ロジック
- 基本温度の適用
- テキスト特性による修正
- 最終温度の範囲チェック
- モデル固有の制約対応

## 結果分析システム

### 感情次元の分析
1. 数値評価（0-100）
   - 面白さ：テキストの魅力度
   - 驚き：意外性や新規性
   - 悲しみ：悲嘆や喪失感
   - 怒り：不満や憤りの程度

2. 理由付けの生成
   - 具体的な根拠の提示
   - テキストからの引用
   - 解釈の妥当性説明

### 自動集計機能
- モデル別の統計
- ペルソナ間の比較
- テキスト種別の分析
- 時系列でのトレンド

### 品質管理
- 応答の一貫性チェック
- 数値範囲の検証
- 理由付けの充実度評価
- エラーケースの検出

## バッチ処理システム

### コスト最適化
- JSONLフォーマットの活用
- 50%のコスト削減を実現
- キャッシュ入力の利用
- リソースの効率的な使用

### プロバイダー別の実装
1. OpenAI
   - 標準モデルのサポート
   - 推論モデルの特殊処理
   - 自動エラー回復
   - 結果の自動変換

2. Claude
   - Message Batches API対応
   - 100,000リクエスト上限
   - 29日間の結果保持
   - レート制限の管理

3. kluster.ai
   - DeepSeekモデル対応
   - Llamaモデル対応
   - 24時間処理ウィンドウ
   - OpenAI互換インターフェース

### エラーハンドリング
- モデル固有のエラー処理
- バックオフ付き自動リトライ
- 部分的失敗からの回復
- 詳細なエラーログ
