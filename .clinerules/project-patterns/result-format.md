# 結果フォーマットの仕様（2025-04-11更新）

## 評価項目

実験結果は以下の4つの感情に対する数値評価（0-100）と理由を含みます：

- 面白さ (Interesting/Fun)
- 驚き (Surprise)
- 悲しみ (Sadness)
- 怒り (Anger)

## フォーマット構造

### 標準フォーマット
```
Q1. 面白さ(数値): [0-100]
Q1. 面白さ(理由): [explanation]

Q2. 驚き(数値): [0-100]
Q2. 驚き(理由): [explanation]

Q3. 悲しみ(数値): [0-100]
Q3. 悲しみ(理由): [explanation]

Q4. 怒り(数値): [0-100]
Q4. 怒り(理由): [explanation]
```

### 許容される代替フォーマット（2025-04-11追加）
以下の形式も有効な応答として認識されます：

1. 標準Q&A形式
```
Q1. 面白さ: (数値): 80
Q1. 面白さ: (理由): [explanation]
```

2. シンプル形式
```
Q1. 面白さ: 80
Q1. 面白さ理由: [explanation]
```

3. 日本語評価形式
```
面白さの評価: 80
面白さ理由: [explanation]
```

4. レベル表記形式
```
面白さレベル: 80
面白さの理由: [explanation]
```

5. 括弧形式
```
「面白さ」: 80
「面白さ」の理由: [explanation]
```

6. 角括弧形式
```
[面白さ]: 80
[面白さ]理由: [explanation]
```

## パターンマッチング仕様（2025-04-11追加）

### 数値抽出パターン
```python
patterns = [
    rf"Q\d+\.\s*{question}\(数値\):\s*(\d+)",  # 標準形式
    rf"Q\d+\.\s*{question}:\s*\(数値\):\s*(\d+)",  # 代替形式1
    rf"Q\d+\.\s*{question}\s*数値:\s*(\d+)",  # 代替形式2
    rf"Q\d+\.\s*{question}:\s*(\d+)",  # シンプル形式
    rf"{question}(?:の評価)?(?:\s*[:：]\s*|\s+)(\d+)",  # 日本語形式1
    rf"{question}(?:度|レベル)(?:\s*[:：]\s*|\s+)(\d+)",  # 日本語形式2
    rf"「{question}」\s*[:：]?\s*(\d+)",  # 括弧形式
    rf"\[{question}\]\s*[:：]?\s*(\d+)"  # 角括弧形式
]
```

### 理由抽出パターン
```python
reason_patterns = [
    rf"Q\d+\.\s*{question}\(理由\):\s*(.+?)(?=(?:\n[QA]|$))",  # 標準形式
    rf"Q\d+\.\s*{question}:\s*\(理由\):\s*(.+?)(?=(?:\n[QA]|$))",  # 代替形式
    rf"Q\d+\.\s*{question}\s*理由:\s*(.+?)(?=(?:\n[QA]|$))",  # シンプル形式
    rf"{question}(?:の)?理由:\s*(.+?)(?=(?:\n|$))"  # 日本語形式
]
```

## 評価基準

### 数値評価（0-100）
- 0: 全く感じない
- 25: わずかに感じる
- 50: 中程度
- 75: 強く感じる
- 100: 非常に強く感じる

### 品質基準（2025-04-11追加）
- 数値範囲の遵守（0-100）
- 必須フィールドの存在確認
- 理由の記述の充実度
- フォーマットの一貫性

### 検証プロセス
1. パターンマッチングによる形式確認
2. 数値範囲の検証
3. 理由の存在確認
4. エラー時の自動再試行（最大3回）

## メタデータ記録
- 使用されたパターン
- 検証ステータス（success/retry_success/failed）
- 再試行回数（該当する場合）
